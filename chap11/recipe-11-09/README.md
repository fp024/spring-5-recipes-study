## λ μ‹ν”Ό 11-09 μ΅ μ‹¤ν–‰ν•κΈ° - μ΅μ„ λ§¤κ°λ³€μν™”ν•κΈ°



### μ΄λ² μμ λ”...

> νλΌλ―Έν„°λ¥Ό μ¤ν…μ— μ–΄λ–»κ² μ „λ‹¬ν•  μ μλ”μ§€ λ³΄λ” κ²ƒμ΄λ―€λ΅, μ¤μΌ€μ¥΄λ¬ κ΄€λ ¨ μ½”λ“λ” μ κ±°ν•λ”κ² λ‚«κ² λ‹¤.
>
> μ €μλ‹ μμ λ¥Ό λ³΄λ©΄ μ¤μΌ€μ¥΄λ¬ μ½”λ“λ¥Ό κ·Έλ€λ΅ μ μ§€ν•λ©΄μ„ mainλ©”μ„λ“λ΅ Jobμ‹¤ν–‰ν•λ” μ½”λ“κ°€ νΌμ¬λμ–΄μλ‹¤.
>
> * μ¤μΌ€μ¥΄λ¬ μ½”λ“λ” μ§€μ°κ³ , λ©”μΈ λ©”μ„λ“μ—μ„ μ¤ν…μΌλ΅ JobParameter μ „λ‹¬μ΄ μλλ”μ§€ λ³΄μ!



### `@StepScope` κ°€ μ μ©λλ” λ²”μ„λ”...

Stepμ κµ¬μ„±μ”μ†μΈ readerλ‚ writerλ“±μ— μ„ μ–Έν•΄μ•Ό μ λ€λ΅ λ¨. Step λ©”μ„λ“ μ„μ—λ‹¤ μ„ μ–Έν•λ©΄ μ—λ¬λ‚¨..

```
Caused by: java.lang.IllegalStateException: No context holder available for step scope
```

Step λ©”μ„λ“ μ„μ—λ” `@JobScope` λ¥Ό λ¶™μ—¬μ•Ό ν–μ.



### μ§„ν–‰

csvνμΌμ„ μ½κ³  μ“°λ” μ„Έλ¶€ κµ¬ν„μ„ ν•μ§€μ•κ³  λ‹¨μ§€ νλΌλ―Έν„°κ°€ μ μ „λ‹¬λλ”μ§€λ§ ν™•μΈ λλ„λ΅ κµ¬ν„ν–λ‹¤.

@StepScopeλ¥Ό μ¶”κ°€ν•΄μ„ Job νλΌλ―Έν„°κ°€ κµ¬ν„λλ” κ²ƒμ„ ν™•μΈν•λ ¤λ©΄ readerλ‚ writerλ¥Ό λ°ν™ν•λ” λ©”μ„λ“μ„μ— λ¶™μ—¬μ•Όλμ„..

λ‹¨μν•κ² νλΌλ―Έν„°λ΅ max.count κ°’μ„ λ°›μ•„μ„ μ²­ν¬λ‹¨μ„ 5μ”© μ½λ” readerμ™€ κ·Έκ²ƒμ„ λ‹¨μ ν™”λ©΄ μ¶λ ¥ν•λ” writerλ¥Ό λ§λ“¤μ—λ‹¤.

```java
@StepScope
  @Bean
  ItemReader<Long> customReader(@Value("#{jobParameters['max.count']}") Long maxCount) {
    return new ItemReader<>() {
      private Long count = 0L;
      
      @Override
      public Long read() throws Exception {
        return fetchData();
      }

      private Long fetchData() {
        if (maxCount > count) {
          return ++count;
        } else {
          return null;
        }
      }
    };
  }

  @Bean
  ItemWriter<Long> customWriter() {
    return items -> LOGGER.info("π‘Ί κ·Έλƒ¥ ν™”λ©΄ μ¶λ ¥: {}", items);
  }
```



---

### μ΄κ±Έλ΅... 11μ¥ μ¤ν”„λ§ λ°°μΉλ” λ‹¤ λ΄¤λ”λ°..

μ¤‘κ°„μ— λ„λ¬΄μ§€ μ΄ν•΄κ°€ μ•λμ„ μ κΉ λ©μ·„μ—λ”λ°... κ·Έμ‚¬μ΄μ— μ¤ν”„λ§ λ°°μΉ μ™„λ²½κ°€μ΄λ“ 2νμ„ 5μ¥κΉμ§€ λ³Ό κΈ°νκ°€ μμ—λ”λ°...

κ·Έκ²ƒμ„ λ³΄κ³ λ‚λ‹ λ‚λ¨Έμ§€ λ¶€λ¶„λ“¤μ΄ μ΄ν•΄κ°€ μλμ—λ‹¤. π‘

κ·Έλ¦¬κ³  λΉ™(Bing)λ„ Reader ν΄λμ¤λ¥Ό κµ¬ν„ν•λ” λ°©λ²•μ— λ€ν•΄μ„ μ μ•λ ¤μ¤μ„ ν° λ„μ›€μ΄ λμ—μ π‰π‘

* μ±… μ¶”μ²: 
  * μ¤ν”„λ§ λ°°μΉ μ™„λ²½ κ°€μ΄λ“ 2/e
    *  https://www.yes24.com/Product/Goods/99422216

